<html>
    <head>
        <meta charset=utf-8 />
        <title>Geotrio 2.0</title>
        <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
        <script src='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.js'></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
        <link href='https://api.tiles.mapbox.com/mapbox.js/v2.1.5/mapbox.css' rel='stylesheet' />
        <style>
            body { margin:0; padding:0; }
            #map { position:absolute; top:0; bottom:0; width:100%; }
        </style>
    </head>
    <body>
        <div id='map'></div>
        <script>
            L.mapbox.accessToken = 'pk.eyJ1IjoiYW5uYWNoaW5uIiwiYSI6Il9FWFVaX3MifQ.LWyZpBRxnoARXldAE_ilcQ';
            var map = L.mapbox.map('map', 'examples.map-i86nkdio')
            .setView([45.5217, -73.6673], 11);
            $.getJSON("https://spreadsheets.google.com/feeds/list/1QaPb_Hnnq3WozVeMHaq0t1k0_nIr3XuFyEf4Pyrza4U/ov3895y/public/values?alt=json", function(data){  
                $.each(data.feed.entry, function(index, value) {
                    if (value.gsx$latitude.$t === ""){
                        return true;
                    } else if (value.gsx$longitude.$t === ""){
                        return true;
                    } else {
                        var lat = Number(value.gsx$latitude.$t);
                        var lng = Number(value.gsx$longitude.$t);
                        var time = value.gsx$timestamp.$t;
                        var location = value.gsx$streetintersectionorapproximatestreetaddressoftheaccident.$t;
                        var city =  value.gsx$cityofbikeaccident.$t;
                        var injuries= value.gsx$provideabriefdescriptionofthebikeaccidentandanyinjuriesresultingfromit.$t;
						
                        var colour = function() {
                            var cause = value.gsx$causeofthebikingaccident.$t;
                                switch (cause) {
                                    case 'Obstruction in bike path':
                                        return '#FFCCFF'
                                        break;
                                    case 'Traffic altercation':
                                        return '#FFCC66'
                                        break;
                                    case 'Missing traffic sign or signal':
                                        return '#FF66CC'
                                        break;
                                    case 'Poor weather conditions':
                                        return '#CC66FF'
                                        break;
                                    case 'No bike path':
                                        return '#FFFF66'
                                        break;
                                    default:
                                        return '#FF3333'
                                };
                            };
                            
                        L.mapbox.featureLayer({
                            type: 'Feature',
                            geometry: {
                                type: 'Point',
                                coordinates: [lng,lat]
                            },
                            properties: {
                                title: location,
                                description: injuries,
                                'marker-size': 'medium',
                                'marker-color': colour(),
                                'marker-symbol': 'bicycle'
                            }
                        }).addTo(map);
                    };
                });
            });

            L.mapbox.featureLayer()
                .loadURL('bikePath.geojson')
                .addTo(map);
</script>
   
<style>
.legend label,
.legend span {
  display:block;
  float:left;
  height:20px;
  width:16.6%;
  text-align:center;
  font-size:10px;
  color:#808080;
  }
</style>

<div id='legend' style='display:none;'>
    <strong>Cause of Bike Accident:</strong>
    <br></br>
  <nav class='legend clearfix'>
    <span style='background:#FFCCFF;'></span>
    <span style='background:#FFCC66;'></span>
    <span style='background:#FF66CC;'></span>
    <span style='background:#CC66FF;'></span>
    <span style='background:#FFFF66;'></span>
<<<<<<< Updated upstream
    <label>Obstruction in path</label>
    <label>Traffic altercation</label>
    <label>Missing sign</label>
    <label>Bad weather</label>
=======
    <span style='background:#FF3333;'></span>
    <label>Obstruction in Path</label>
    <label>Traffic Altercation</label>
    <label>Missing Sign</label>
    <label>Bad Weather</label>
>>>>>>> Stashed changes
    <label>No bike path</label>
    <label>Other</label>
        <br></br>
        <br></br>
        </nav>
</div>
 </body>
        
//setTimeout(function(){
//   window.location.reload(1);
//}, 5000);
        
<script>
    map.legendControl.addLegend(document.getElementById('legend').innerHTML);
</script>
</html>

